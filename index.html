<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">

		<title>Dlaczego 99% firm, które tworzą API&nbsp;RESTowe kłamie?</title>

		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/black.css" id="theme">

		<!-- Code syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>

		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->

        <style>
            .author{
                width: 500px;
                font-size: 70% !important;
                font-style: italic !important;
                color: #ccc;
                text-align: right;
                padding-left: 350px !important;
            }
        </style>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>Dlaczego 99% firm, które tworzą API&nbsp;RESTowe kłamie?</h2>
					<p>
						<small><a href="http://bandrzejczak.com">Bartek Andrzejczak</a> / <a href="http://twitter.com/bandrzejczak">@bandrzejczak</a></small>
					</p>
				</section>

                <section data-markdown>
                    <script type="text/template">
## Agenda

- Geneza kłamstwa
- Co to jest HATEOAS i jak to się wymawia?
- REST aka HATEOAS?
- Czy HATEOAS jest mi potrzebny?
- HATEOAS od strony serwera
- HATEOAS od strony klienta
                    </script>
                </section>

                <section>
                    <h3>Czym właściwie jest REST?</h3>
                    <blockquote class="fragment">
                        This chapter introduces and elaborates the Representational State Transfer (REST) <span class="fragment highlight-red">architectural style</span> for distributed hypermedia systems (...)
                    </blockquote>
                    <blockquote class="fragment">
                        (...) a style is a named <span class="fragment highlight-red">set of constraints</span> on architectural elements that induces the set of properties desired of the architecture.
                    </blockquote>
                    <div class="fragment author">
                        "Architectural Styles and the Design of Network-based Software Architectures"<br />
                        Roy T. Fielding
                    </div>
                </section>

                <section>
                    <h3>Może powtórzymy angielski?</h3>
                    <section>
                        <img src="assets/angielski.png" style="border:0">
                    </section>
                    <section>
                        <img src="assets/hateoas1.png" style="border:0; margin-top:30px;">
                    </section>
                    <section>
                        <img src="assets/hateoas2.png" style="border:0">
                    </section>
                    <section>
                        <img src="assets/hateoas3.png" style="border:0; width: 150%;">
                    </section>
                    <section>
                        <h4>
                            <a href="https://translate.google.pl/#en/en/hateoas">
                                Google
                            </a>
                        </h4>
                        <audio controls>
                            <source src="assets/google-hateoas.mp3" type="audio/mpeg">
                        </audio>
                        <br /><br />
                        <h4>
                            <a href="http://blog.ambroselittle.com/how-to-pronounce-hateoas/">
                                Ambrose Little
                            </a>
                        </h4>
                        <audio controls>
                            <source src="assets/little-hateoas.mp3" type="audio/mpeg">
                        </audio>
                    </section>
                </section>

                <section>
                    <h3>Ograniczenia narzucane przez REST</h3>
                    <ul>
                        <li>Podział klient-serwer</li>
                        <li>Bezstanowość serwera</li>
                        <li>Cache</li>
                        <li>Jednolity interfejs
                            <ul>
                                <li>Identyfikacja zasobów</li>
                                <li>Manipulacja zasobami przez reprezentacje</li>
                                <li>Samoopisujące się wiadomości</li>
                                <li class="fragment highlight-red">HATEOAS</li>
                            </ul>
                        </li>
                        <li>Podział na warstwy</li>
                        <li>Code-on-demand (Opcjonalne)</li>
                    </ul>
                </section>

                <section>
                    <blockquote>
                    Role, artefakty, zdarzenia oraz reguły <span class="fragment">Scruma</span> są niezmienne i choć możliwe jest wykorzystanie tylko wybranych jego elementów, wynikiem takiego postępowania nie będzie <span class="fragment">Scrum</span>. <span class="fragment">Scrum</span> istnieje tylko w swojej pełnej postaci i sprawdza się doskonale w roli ramy dla innych technik, metodyk czy praktyk.
                    </blockquote>
                    <div class="fragment author">
                        Scrum Guide
                    </div>
                </section>

                <section>
                    <h3>Jak ważny jest HATEOAS?</h3>
                    <blockquote>
                        In order to obtain a uniform interface, multiple architectural constraints are needed to guide the behavior of components. REST is defined by four interface constraints: identification of resources; manipulation of resources through representations; self-descriptive messages; and, <span class="fragment highlight-red">hypermedia as the engine of application state</span>. These constraints will be discussed in Section 5.2.
                    </blockquote>
                    <div class="author">
                        "Architectural Styles and the Design of Network-based Software Architectures"<br />
                    Roy T. Fielding
                    </div>
                </section>

                <section>
                    <img src="assets/picard.jpg" style="border:0; width: 800px;" />
                </section>

                <section>
                    The name “Representational State Transfer” is intended to evoke an image of how a well-designed Web application behaves:
                    <ul>
                        <li class="fragment">a network of web pages (a virtual <span class="fragment highlight-red">state-machine</span>)</li>
                        <li class="fragment">where the user progresses through the application by selecting <span class="fragment highlight-red">links</span> (state transitions)</li>
                        <li class="fragment">resulting in the next page (representing the next state of the application) being transferred to the user and rendered for their use</li>
                    </ul>
                </section>

                <section>
                    <h3>Co daje nam HATEOAS?</h3>
                    <section>
                        <img src="assets/states.png" style="background-color: white; margin-top: 50px;">
                    </section>
                    <section>
                        <img src="assets/stateMachine.png" style="background-color: white; margin-top: 50px;">
                    </section>
                    <section>
                        <img src="assets/stateMachine_signed.png" style="background-color: white; margin-top: 50px;">
                    </section>
                </section>

                <section>
                    <h3>Kiedy HATEOAS jest stratą czasu?</h3>
                    <ul>
                        <li class="fragment">Brak wyraźnego flow aplikacji</li>
                        <li class="fragment">CRUD</li>
                        <li class="fragment">Małe API</li>
                    </ul>
                </section>

                <section>
                    <h3>Zalety</h3>
                    <ul>
                        <li class="fragment">Sterowanie przepływem danych w aplikacji</li>
                        <li class="fragment">Sterowanie dostępnymi podzasobami</li>
                        <li class="fragment">Luźniejsze związanie serwera i klienta</li>
                        <li class="fragment">Dodatkowa dokumentacja API (jednak niewystarczająca)</li>
                        <li class="fragment">Ułatwienie dla (twórców) konsumentów API</li>
                    </ul>
                </section>

                <section>
                    <h3>Wady</h3>
                    <ul>
                        <li class="fragment">Więcej pracy</li>
                        <li class="fragment">Więcej transferu</li>
                        <li class="fragment">Brak ekspertów w temacie</li>
                        <li class="fragment">Utopijna idea</li>
                        <li class="fragment"><span class="fragment highlight-red">Tworzenie API dla nieistniejącego klienta</span></li>
                    </ul>
                </section>

                <section>
                    <h3>Dla jakiego klienta nadaje się HATEOAS?</h3>
                    <section>
                        <img src="assets/client-server1.png" style="margin-top: 50px;">
                    </section>
                    <section>
                        <img src="assets/client-server2.png" style="margin-top: 50px;">
                    </section>
                    <section>
                        <img src="assets/client-server3.png" style="margin-top: 50px;">
                    </section>
                    <section>
                        <img src="assets/client-server4.png" style="margin-top: 50px;">
                    </section>
                </section>

                <section>
                    <h3>Format linków</h3>
                    <section data-markdown>
                        <script type="text/template">
#### HTML
```html
<a href="https://twitter.com/baandrzejczak">Bartek Andrzejczak</a>
```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
#### JSON API
```json
{
    "type": "articles",
    "id": "1",
    "title": "Rails is Omakase",
    "links": {
        "author": {
            "self": "/articles/1/links/author",
            "related": "/articles/1/author"
        }
    }
}
```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
#### PayPal API
```json
{
    "batch_header": { ... },
    "items": [ ... ],
    "links": [
        {
            "href": "https://api.paypal.com/v1/payments/7BSCA3W",
            "rel": "self",
            "method": "GET"
        },
        {
            "href": "https://api.paypal.com/v1/payments/7BSCA3W/refund",
            "rel": "refund",
            "method": "POST"
        }
    ]
}
```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
#### VerticalResponse API
```json
"links": {
    "up": {
        "url": "https://vrapi.com/api/v1/contacts"
    },
    "lists": {
        "url": "https://vrapi.com/api/v1/contacts/109951393486/lists"
    },
    "messages": {
        "url": "https://vrapi.com/api/v1/contacts/109951393486/messages"
    },
    "stats": {
        "url": "https://vrapi.com/api/v1/contacts/109951393486/stats"
    }
}
```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
#### Hypertext Application Language (HAL)
```json
{
    "_links": {
        "self": {
            "href": "https://api.com/taxes/31588",
            "title": "This Tax"
        },
        "https://api.foxycart.com/rels/store": {
            "href": "https://api.com/stores/66",
            "title": "This Store"
        },
        "https://api.foxycart.com/rels/tax_item_categories": {
            "href": "https://api.com/taxes/31588/tax_item_categories",
            "title": "Tax Item Category relationships"
        }
    }
}
```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
#### JSON-LD
```json
{
    "@context": "http://json-ld.org/contexts/person.jsonld",
    "@id": "http://dbpedia.org/resource/John_Lennon",
    "name": "John Lennon",
    "born": "1940-10-09",
    "spouse": "http://dbpedia.org/resource/Cynthia_Lennon"
}
```
                        </script>
                    </section>
                    <section data-markdown>
                        <script type="text/template">
#### Nagłówki HTTP
```
Link: </deployments>;
    rel="self";
    actions="[
        {'name':'deploy','method':'POST'},
        {'name':'list','method':'GET'}
    ]"
```
                        </script>
                    </section>
                </section>

                <section>
                    <h2>HATEOAS na serwerze</h2>
                </section>

                <section>
                    <h3>Jersey Declarative Linking</h3>
                    <section>
                        <h4>Najprostszy przykład</h4>
                        <pre><code data-trim>
@Path("/widgets")
public class WidgetsResource {
    @GET
    public Widgets get() {
        return new Widgets();
    }
}

public class Widgets {
    @InjectLink(resource=WidgetsResource.class)
    URI u;
}
                        </code></pre>
                        <pre class="fragment"><code data-trim>
{
    "u": "/widgets"
}
                        </code></pre>
                    </section>
                    <section>
                        <h4>Parametry ścieżek</h4>
                        <pre><code data-trim>
@Path("/widgets/{id}")
public class SingleWidgetResource {
    ...
}

public class RelatedWidget {
    @InjectLink(
        resource=SingleWidgetResource.class,
        bindings={
            @Binding("${resource.anotherId}")
        }
    )
    URI anotherWidget;
    String anotherId;
}
                        </code></pre>
                        <pre class="fragment"><code data-trim>
{
    "anotherId": "123",
    "anotherWidget": "/widgets/123"
}
                        </code></pre>
                    </section>
                    <section>
                        <h4>Stałe ścieżki</h4>
                        <pre><code data-trim>
public class Widgets {
    @InjectLink("/widgets", rel="widgets")
    URI u;
}
                        </code></pre>
                    </section>
                    <section>
                        <h4>Linki w nagłówkach</h4>
                        <pre><code data-trim>
@InjectLinks(
    value=@InjectLink("widgets/${resource.nextId}"),
    rel="next"
)
public class Widget {
    String nextId;
}
                        </code></pre>
                    </section>
                    <section>
                        <h3>Plusy</h3>
                        <ul style="width: 80%">
                            <li>Wybór pomiędzy linkami w nagłówkach i w reprezentacjach</li>
                        </ul>
                        <h3>Minusy</h3>
                        <ul style="width: 80%">
                            <li class="fragment highlight-red">Silne połączenie reprezentacji z zasobami</li>
                            <li>Annotation hell</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <h3>JAX-RS 2.0</h3>
                    <section>
                        Tylko imperatywna konstrukcja linków.
                        <pre><code data-trim>
@Path("/processes")
public class ProcessesResource {

    ...

    @GET
    public Response list(@Auth AuthUser user) {
        return Response
                .ok(processService.listStartableProcesses(user))
                .links(Link.fromResource(ProcessesResource.class)
                            .rel("self").build())
                .build();
    }

}
                        </code></pre>
                    </section>
                    <section>
                        Ścieżki można pobierać z metod...
                        <pre><code data-trim>


@GET
public Response list(@Auth AuthUser user) {
    return Response
            .ok(processService.listStartableProcesses(user))
            .links(Link
                    .fromMethod(ProcessesResource.class, "listDetails")
                    .rel("details").build())
            .build();
}

//effective path is /processes/details
@Path("/details")
public Response listDetails(@Auth AuthUser user){
    ...
}
                        </code></pre>
                    </section>
                    <section>
                        ...lub hardcodować
                        <pre><code data-trim>
@GET
public Response list(@Auth AuthUser user) {
    return Response
            .ok(processService.listStartableProcesses(user))
            //Link: &lt;/processes/123&gt;; rel="sampleProcess"
            .links(Link.fromPath("/processes/{id}")
                        .rel("sampleProcess").build("123"))
            .build();
}
                        </code></pre>
                    </section>
                    <section>
                        <h3>Plusy</h3>
                        <ul style="width: 80%">
                            <li>Brak ingerencji w klasy reprezentacji</li>
                            <li>Implementacja przez wiele różnych frameworków</li>
                        </ul>
                        <h3>Minusy</h3>
                        <ul style="width: 80%">
                            <li>Płaska struktura linków</li>
                            <li>Nagłówek trudniej jest analizować niż reprezentację</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <h3>spring-hateoas</h3>
                    <section>
                        Aby dodawać linki do klasy, musi ona rozszerzać klasę ResourceSupport - linki staną się częścią reprezentacji.
                        <pre><code data-trim>
public class Greeting extends ResourceSupport {

    private final String content;

    @JsonCreator
    public Greeting(@JsonProperty("content") String content) {
        this.content = content;
    }

    public String getContent() {
        return content;
    }
}
                        </code></pre>
                    </section>
                    <section>
                        Linki dodajemy bezpośrednio do reprezentacji
                        <pre><code data-trim>
private static final String TEMPLATE = "Hello, %s!";

@RequestMapping("/greeting")
@ResponseBody
public HttpEntity&lt;Greeting&gt; greeting(
        @RequestParam(value = "name") String name) {
    Greeting greeting = new Greeting(String.format(TEMPLATE, name));
    greeting.add(
        ControllerLinkBuilder.linkTo(
            ControllerLinkBuilder.methodOn(GreetingController.class)
                .greeting(name)
        ).withSelfRel()
    );
    return new ResponseEntity&lt;Greeting&gt;(greeting, HttpStatus.OK);
}
                        </code></pre>
                    </section>
                    <section>
                        Wynik:<br />
                        <small>/greeting?name=World</small>
                        <pre><code data-trim>
{
    "content":"Hello, World!",
    "_links":{
        "self":{
            "href":"http://localhost:8080/greeting?name=World"
        }
    }
}
                        </code></pre>
                    </section>
                    <section>
                        <h3>Plusy</h3>
                        <ul style="width: 80%">
                            <li>Minimalna ingerencja w klasy reprezentacji</li>
                            <li>Możliwość zagnieżdżania linków</li>
                            <li>Obsługa różnych formatów linków</li>
                            <li>Wsparcie JAX-RS</li>
                        </ul>
                        <h3>Minusy</h3>
                        <ul style="width: 80%">
                            <li>Narastająca logika w kontrolerach, w przypadku linkowania bardziej skomplikowanych struktur (np.&nbsp;kolekcji)</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <h2>HATEOAS w kliencie</h2>
                </section>
			</div>
		</div>
		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>
		<script>
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,
                width: 1024,
                height: 768,
				transition: 'slide',
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, condition: function() { return !!document.querySelector( 'pre code' ); }, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true },
					{ src: 'plugin/notes/notes.js', async: true }
				]
			});
		</script>
	</body>
</html>
